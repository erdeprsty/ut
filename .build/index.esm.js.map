{"version":3,"file":"index.esm.js","sources":["../src/constants/index.ts","../src/helpers/request.ts","../src/core/elearning/auth.ts","../src/core/elearning/course.ts","../src/core/elearning/user.ts","../src/core/elearning/index.ts","../src/core/app.ts","../src/helpers/platform.ts","../src/index.ts"],"sourcesContent":["export interface Config {\n\tBASE_URL: string;\n}\nexport const config: Config = {\n\tBASE_URL: \"https://elearning.ut.ac.id\",\n};\n","import axios from \"axios\";\nimport { config } from \"@/constants\";\n\naxios.defaults.baseURL = config.BASE_URL;\naxios.defaults.validateStatus = (status) => {\n\treturn status >= 200 && status < 400;\n};\n\nexport default axios;\n","// Interfaces\nimport {\n\tIELearningAuth,\n\tELearningAuthSession,\n\tELearningGetSessionResult,\n} from \"@/interfaces/elearning/auth\";\n\n// Libraries\nimport * as cheerio from \"cheerio\";\nimport { CheerioAPI } from \"cheerio\";\n\n// Helpers\nimport request from \"@/helpers/request\";\nimport { config } from \"@/constants\";\n\nexport class Auth implements IELearningAuth {\n\tprotected getCsrfLoginElement(parsedHtml: CheerioAPI) {\n\t\treturn parsedHtml(\"input[name=logintoken]\").first();\n\t}\n\tprotected getSessionVerifyLinkElement(parsedHtml: CheerioAPI) {\n\t\treturn parsedHtml(\"a\")\n\t\t\t.filter((_, el) => {\n\t\t\t\treturn el.attribs.href.indexOf(\"testsession\") > -1;\n\t\t\t})\n\t\t\t.first();\n\t}\n\tprotected getSessionFromCookies(cookieStrings: string[] | undefined) {\n\t\tif (!cookieStrings)\n\t\t\tthrow new Error(`Error parsing session from cookie, given empty cookies`);\n\t\tconst filteredCookies = cookieStrings.filter(\n\t\t\t(cookieString) => cookieString.toLowerCase().indexOf(\"moodlesession\") > -1\n\t\t);\n\t\tif (filteredCookies.length === 0)\n\t\t\tthrow new Error(`No session found in cookies`);\n\t\tconst sessionCookie = filteredCookies[0];\n\t\tconst session = sessionCookie.match(/MoodleSession=([^;]*)/);\n\t\tif (!session)\n\t\t\tthrow new Error(\n\t\t\t\t`Error parsing session from cookie, invalid session cookie`\n\t\t\t);\n\t\treturn session[1];\n\t}\n\tprotected getSession(): Promise<ELearningGetSessionResult> {\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\ttry {\n\t\t\t\tconst response = await request(`${config.BASE_URL}/login/index.php`);\n\t\t\t\tconst htmlText = await response.data;\n\t\t\t\tconst cookieStrings = response.headers[\"set-cookie\"];\n\t\t\t\tconst session = this.getSessionFromCookies(cookieStrings);\n\t\t\t\tconst parsedHtml = cheerio.load(htmlText);\n\t\t\t\tconst csrfToken = this.getCsrfLoginElement(parsedHtml).val();\n\t\t\t\tif (typeof csrfToken !== \"string\")\n\t\t\t\t\tthrow new Error(\"CSRF token not found\");\n\t\t\t\treturn resolve({\n\t\t\t\t\ttoken: csrfToken,\n\t\t\t\t\tsession,\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\treturn reject(err);\n\t\t\t}\n\t\t});\n\t}\n\tpublic async login(\n\t\tusername: string,\n\t\tpassword: string\n\t): Promise<ELearningAuthSession> {\n\t\ttry {\n\t\t\tconst { token, session } = await this.getSession();\n\t\t\tconst response = await request(\n\t\t\t\t\"https://elearning.ut.ac.id/login/index.php\",\n\t\t\t\t{\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"content-type\": \"application/x-www-form-urlencoded\",\n\t\t\t\t\t\tcookie: `MoodleSession=${session}`,\n\t\t\t\t\t},\n\t\t\t\t\tdata: `anchor=&logintoken=${token}&username=${username}&password=${password}`,\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tmaxRedirects: 0,\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst isInvalidLogin = response.headers[\"location\"]\n\t\t\t\t? response.headers[\"location\"]!.indexOf(\"testsession\") === -1\n\t\t\t\t: true;\n\t\t\tif (isInvalidLogin)\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Login failed, please check your username and password\"\n\t\t\t\t);\n\t\t\tconst cookieStrings = response.headers[\"set-cookie\"];\n\t\t\tconst authSession = this.getSessionFromCookies(cookieStrings);\n\t\t\treturn Promise.resolve(authSession);\n\t\t} catch (err) {\n\t\t\treturn Promise.reject(err);\n\t\t}\n\t}\n}\n\nexport default Auth;\n","// Interfaces\nimport { IELearningCourse } from \"@/interfaces/elearning/course\";\n\n// Libraries\nimport * as cheerio from \"cheerio\";\n\nexport class Course implements IELearningCourse {\n\tpublic getCourses() {}\n}\n\nexport default Course;\n","// Interfaces\nimport { IELearning } from \"@/interfaces/elearning\";\nimport { IELearningUser } from \"@/interfaces/elearning/user\";\nimport request from \"@/helpers/request\";\n\nexport class ELearningUser implements IELearningUser {\n\tconstructor(private elearning: IELearning) {}\n\tpublic async getUser() {\n\t\ttry {\n\t\t\tif (this.elearning.isEmptySession())\n\t\t\t\tthrow new Error(\"No session found, please authenticate first\");\n\t\t\tconst res = await request({\n\t\t\t\tmethod: \"get\",\n\t\t\t\turl: \"/my/\",\n\t\t\t\theaders: {\n\t\t\t\t\tCookie: `MoodleSession=${this.elearning.session}`,\n\t\t\t\t},\n\t\t\t\tmaxRedirects: 0,\n\t\t\t});\n\t\t\treturn res.data;\n\t\t} catch (err) {\n\t\t\treturn Promise.reject(err);\n\t\t}\n\t}\n}\n\nexport default ELearningUser;\n","// Interfaces\nimport {\n\tIELearning,\n\tELearningCredential,\n\tCreateELearningOptions,\n} from \"@/interfaces/elearning\";\nimport {\n\tELearningAuthSession,\n\tIELearningAuth,\n} from \"@/interfaces/elearning/auth\";\nimport { IELearningCourse } from \"@/interfaces/elearning/course\";\nimport { IELearningUser } from \"@/interfaces/elearning/user\";\n\n// Classes\nimport Auth from \"@/core/elearning/auth\";\nimport Course from \"@/core/elearning/course\";\nimport User from \"@/core/elearning/user\";\n\nexport class ELearning implements IELearning {\n\tpublic session: ELearningAuthSession | null = null;\n\tprivate auth: IELearningAuth;\n\tprivate course: IELearningCourse;\n\tprivate user: IELearningUser;\n\tprivate credential: ELearningCredential = {\n\t\tusername: \"\",\n\t\tpassword: \"\",\n\t};\n\tconstructor(options: CreateELearningOptions = {}) {\n\t\tthis.auth = new Auth();\n\t\tthis.course = new Course();\n\t\tthis.user = new User(this);\n\t\tif (options.session) {\n\t\t\tthis.session = options.session;\n\t\t}\n\t\tif (options.credential) {\n\t\t\tthis.credential.username = options.credential.username;\n\t\t\tthis.credential.password = options.credential.password;\n\t\t}\n\t}\n\tpublic isEmptySession() {\n\t\treturn this.session === null;\n\t}\n\tpublic async authenticate(\n\t\tcredentials: ELearningCredential = {\n\t\t\tusername: this.credential.username,\n\t\t\tpassword: this.credential.password,\n\t\t}\n\t): Promise<IELearning> {\n\t\tthis.session = await this.auth.login(\n\t\t\tcredentials.username,\n\t\t\tcredentials.password\n\t\t);\n\t\treturn Promise.resolve(this);\n\t}\n\tpublic async getCourses() {\n\t\treturn this.course.getCourses();\n\t}\n\tpublic async getUser() {\n\t\treturn this.user.getUser();\n\t}\n}\n\nexport default ELearning;\n","// Interfaces\nimport { IELearning, CreateELearningOptions } from \"@/interfaces/elearning\";\nimport ELearning from \"@/core/elearning\";\n\nexport interface IApp {\n\tcreateElearning(options: CreateELearningOptions): IELearning;\n}\n\nexport class App implements IApp {\n\tconstructor() {}\n\tpublic createElearning(options: CreateELearningOptions = {}) {\n\t\treturn new ELearning(options);\n\t}\n}\n\nexport const UT = App;\nexport default App;\n","export const isNode = () => {\n\treturn (\n\t\ttypeof process !== \"undefined\" &&\n\t\tprocess.versions != null &&\n\t\tprocess.versions.node\n\t);\n};\n","import App from \"@/core/app\";\nimport { isNode } from \"@/helpers/platform\";\n\nif (!isNode())\n\tthrow new Error(\"This code should only be run in Node.js environment.\");\n\nexport default App;\n"],"names":["request","User"],"mappings":"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"}